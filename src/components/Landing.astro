---
import { Image } from "astro:assets";
import ModeCard from "@components/ModeCard.astro";
import heroImage from "@assets/images/community-card.jpg";
import hookupsImage from "@assets/images/hookups-card.png";
import communityImage from "@assets/images/community-card.png";
// Landing.astro
// This component serves as the main entry point for the new, conversion-focused landing page.
// It is designed to be mobile-first and uses the dual-theme system (Community/Hookups).

// --- A/B Test Variants ---
const copyVariants = {
  control: {
    title: "Your Connection, Your Choice.",
    ctaPrivate: "Start Private — Meet discreetly, arrange safely.",
    ctaCommunity: "Join Community — Find events & connections.",
  },
  a: {
    title: "Find Your Vibe in Limpopo.",
    ctaPrivate: "Explore Discreetly — Your privacy is our priority.",
    ctaCommunity: "Discover Events — Connect with your culture.",
  },
  b: {
    title: "Two Experiences. One Platform.",
    ctaPrivate: "Go Private — Safe, anonymous, and direct.",
    ctaCommunity: "Go Public — Join groups and find your people.",
  },
};

// --- Logic to select the active variant ---
const { searchParams } = Astro.url;
const variantKey = searchParams.get('variant')?.toLowerCase();
const hero = {
  subtitle: "Whether you seek a private spark or a public square, find your place in Limpopo. Two distinct experiences, one platform.",
  ...(copyVariants[variantKey] || copyVariants.control),
};

const trustSignals = [
  { icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 1.944A11.954 11.954 0 012.166 5.002a11.954 11.954 0 01-1.611 3.993 1.14 1.14 0 00.103 1.25l.01.011c.11.123.26.19.413.19h.01a1.137 1.137 0 00.99-1.299 9.539 9.539 0 00-2.31-4.998 9.54 9.54 0 00-1.02-1.33C.003 4.29.002 4.288 0 4.286v-.002C.002 4.283 0 4.28.002 4.277a.7.7 0 01.02-.128C.13 3.65 1.513 1.353 5.44 1.01A.7.7 0 016.14.31a.7.7 0 01.698.698C6.51 5.376 4.29 9.35 4.288 9.353a.7.7 0 01-1.22.503A9.536 9.536 0 00.5 4.858a9.535 9.535 0 004.998 2.31.7.7 0 01.298.99l-.01.01a.7.7 0 01-1.25-.102A11.954 11.954 0 011.944 10 11.954 11.954 0 015.002 17.834a11.954 11.954 0 013.993 1.611 1.14 1.14 0 001.25-.103l.011-.01c.123-.11.19-.26.19-.413v-.01a1.137 1.137 0 00-1.299-.99 9.539 9.539 0 00-4.998-2.31 9.54 9.54 0 00-1.33-1.02c-.99-.66-.992-.662-.994-.664h-.002c-.001 0-.004-.002-.006-.004a.7.7 0 01-.128-.02C3.65 13.87 1.353 12.487 1.01 8.56a.7.7 0 01.31-0.702.7.7 0 01.698.698c.328 3.328 2.54 5.54 2.542 5.542a.7.7 0 01.503-1.22A9.536 9.536 0 004.858 19.5a9.535 9.535 0 002.31-4.998.7.7 0 01.99-.298l.01.01a.7.7 0 01-.102 1.25A11.954 11.954 0 0110 18.056a11.954 11.954 0 01-2.166-3.993 1.14 1.14 0 00-.103-1.25l-.01-.011a1.137 1.137 0 00-1.189-.588 1.137 1.137 0 00-.588 1.189c.32 1.13.78 2.21 1.362 3.225a.7.7 0 01-1.12 1.04A13.354 13.354 0 010 10c0-4.418 2.158-8.29 5.44-10.493a.7.7 0 011.04 1.12A11.952 11.952 0 001.944 10z" clip-rule="evenodd" /></svg>`, text: "Private by design" },
  { icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18H9.5a4 4 0 003.943-3.452l.05-.025A2 2 0 0014.567 18h.383a2 2 0 001.942-1.554l.058-.233A4 4 0 0018 13.5V9.5a4 4 0 00-4-4H7.5a4 4 0 00-3.943 3.452l-.05.025A2 2 0 002 10.333z" /></svg>`, text: "Real connections" },
  { icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" /></svg>`, text: "Safety first" }
];

const cards = {
  hookups: {
    title: "Hookups Mode",
    description: "Discreet, direct, and private. Find what you're looking for, safely.",
    link: "/hookups/",
    imageSrc: hookupsImage,
    imageAlt: "Abstract representation of private connections in Hookups mode."
  },
  community: {
    title: "Community Mode",
    description: "Connect with your culture. Join events, find locations, and build your network.",
    link: "/community/",
    imageSrc: communityImage,
    imageAlt: "A group of friends enjoying a community event, representing Community mode."
  }
};
---

<!-- 
  This container defaults to the 'community' (light) theme to ensure a good experience 
  for first-time visitors, even if JavaScript is disabled.
-->
<div data-theme="community" class="bg-theme-bg text-theme-text min-h-screen font-sans">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

    <!-- HERO SECTION -->
    <header class="relative text-center rounded-2xl overflow-hidden py-24">
      <Image
        src={heroImage}
        alt="A vibrant community gathering in Limpopo, showcasing local culture and connection."
        width={1024}
        height={500}
        class="absolute inset-0 w-full h-full object-cover"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/60 to-transparent"></div>
      <div class="relative z-10 text-white">
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold tracking-tight text-balance">
          {hero.title}
        </h1>
        <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-200 text-balance">
          {hero.subtitle}
        </p>

        <!-- HERO CTAs -->
        <div class="mt-8 flex flex-col items-center justify-center gap-4 max-w-md mx-auto">
          <!-- The primary CTA for the "dark" mode experience -->
          <a
            href={cards.hookups.link}
            data-cta-hero-private
            data-set-theme="hookups"
            class="w-full flex flex-col items-center justify-center text-center px-6 py-4 border border-transparent font-medium rounded-full text-theme-cta-primary-text bg-theme-cta-primary-bg hover:bg-theme-cta-primary-bg-hover transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent"
          >
            <span class="font-bold text-lg">{hero.ctaPrivate.split('—')[0]}</span>
            <span class="text-sm opacity-90">{hero.ctaPrivate.split('—')[1]}</span>
          </a>
          <!-- The primary CTA for the "light" mode experience -->
          <a
            href={cards.community.link}
            data-cta-hero-community
            class="w-full flex flex-col items-center justify-center text-center px-6 py-4 border border-transparent font-medium rounded-full text-theme-cta-secondary-text bg-theme-cta-secondary-bg hover:bg-theme-cta-secondary-bg-hover transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent"
          >
            <span class="font-bold text-lg">{hero.ctaCommunity.split('—')[0]}</span>
            <span class="text-sm opacity-90">{hero.ctaCommunity.split('—')[1]}</span>
          </a>
        </div>

        <!-- TRUST SIGNALS -->
        <div class="mt-10 flex flex-wrap justify-center gap-x-6 gap-y-4 text-gray-300">
          {trustSignals.map(signal => (
            <div class="flex items-center gap-2 text-sm font-medium">
              <Fragment set:html={signal.icon} />
              <span>{signal.text}</span>
            </div>
          ))}
        </div>
      </div>
    </header>

    <!-- TRUST STRIP -->
    <section class="mt-12">
      <div class="flex flex-col sm:flex-row justify-center items-center gap-8">
        <div class="text-center">
          <Image src={heroImage} alt="Local community event" class="w-32 h-24 object-cover rounded-lg shadow-md mx-auto" width={400} height={300} />
          <span class="mt-2 block text-sm font-semibold text-theme-text-subtle">Local events</span>
        </div>
        <div class="text-center">
          <Image src={heroImage} alt="Verified event organiser" class="w-32 h-24 object-cover rounded-lg shadow-md mx-auto" width={400} height={300} />
          <span class="mt-2 block text-sm font-semibold text-theme-text-subtle">Verified organisers</span>
        </div>
        <div class="text-center">
          <Image src={heroImage} alt="Safety resources" class="w-32 h-24 object-cover rounded-lg shadow-md mx-auto" width={400} height={300} />
          <span class="mt-2 block text-sm font-semibold text-theme-text-subtle">Safety resources</span>
        </div>
      </div>
    </section>

    <!-- EXPERIENCE CARDS SECTION -->
    <section class="mt-20">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <ModeCard
          title={cards.hookups.title}
          description={cards.hookups.description}
          href={cards.hookups.link}
          imageSrc={cards.hookups.imageSrc}
          imageAlt={cards.hookups.imageAlt}
          dataAttrs={{ "data-set-theme": "hookups" }}
        />
        <ModeCard
          title={cards.community.title}
          description={cards.community.description}
          href={cards.community.link}
          imageSrc={cards.community.imageSrc}
          imageAlt={cards.community.imageAlt}
        />
      </div>
    </section>

    <!-- SIGN UP CTA -->
    <footer class="text-center mt-20">
        <p class="text-lg text-theme-text-subtle">Ready to join?</p>
        <a
            href="/signup"
            data-cta-signup
            class="mt-4 inline-block px-10 py-4 font-bold rounded-full text-theme-cta-primary-text bg-theme-cta-primary-bg hover:bg-theme-cta-primary-bg-hover transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-theme-accent"
        >
            Sign Up Now
        </a>
    </footer>

  </div>
</div>

<script>
  import { applyTheme } from '../scripts/theme.js';

  document.addEventListener('DOMContentLoaded', () => {
    const themeLinks = document.querySelectorAll('[data-set-theme]');
    themeLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const theme = link.getAttribute('data-set-theme');
        if (theme) {
          applyTheme(theme);
        }
        // We don't prevent default, so the navigation still occurs.
      });
    });
  });
</script>
